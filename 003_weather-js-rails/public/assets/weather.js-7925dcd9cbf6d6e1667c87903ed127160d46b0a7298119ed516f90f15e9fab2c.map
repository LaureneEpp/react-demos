{
  "version": 3,
  "sources": ["../../javascript/weather.js"],
  "sourcesContent": ["document.addEventListener(\"DOMContentLoaded\", () => {\n  const cityInput = document.getElementById(\"city-input\");\n  const weatherDisplay = document.getElementById(\"weather-display\");\n  const errorDisplay = document.getElementById(\"error-display\");\n  const errorPopup = document.getElementById(\"error-popup\");\n  const errorMessage = document.getElementById(\"error-message\");\n\n  let weatherData;\n  let locationData;\n\n    // Initialize and update the Mapbox map\n    mapboxgl.accessToken = \"pk.eyJ1IjoibGF1cmVuZWpvIiwiYSI6ImNsbXEyMnV4cjBmOTIybm13bHFkMzZtMXIifQ.LpsNy5grU_lOKJri4VIVZQ\"; // Replace with your Mapbox access token\n    const map = new mapboxgl.Map({\n      container: 'map',\n      style: 'mapbox://styles/mapbox/streets-v11',\n      center: coordinates, // Use the coordinates from locationData\n      zoom: 10,\n    });\n\n  document\n    .getElementById(\"weather-form\")\n    .addEventListener(\"submit\", (event) => {\n      event.preventDefault();\n\n      const city = cityInput.value.trim();\n\n      if (!city) {\n        handleApiError(\"Enter a correct city\");\n        weatherDisplay.textContent = \"\";\n        return;\n      }\n\n    // Fetch location data first\n    fetch(`/location?city=${city}`)\n    .then((response) => {\n      if (response.status === 200) {\n        return response.json();\n      } else {\n        throw new Error(\"Fail to fetch location data!\");\n      }\n    })\n    .then((data) => {\n      locationData = data;\n      return fetch(`/weather?city=${city}`); // Fetch weather data after location data\n    })\n    .then((response) => {\n      if (response.status === 200) {\n        return response.json();\n      } else {\n        throw new Error(\"Fail to fetch weather data!\");\n      }\n    })\n    .then((data) => {\n      weatherData = data;\n      displayWeather(weatherData);\n      errorDisplay.textContent = \"\";\n      appendInfoButton();\n      // Update the Mapbox map using locationData\n      updateMap(locationData);\n    })\n    .catch((error) => {\n      handleApiError(error.message);\n    });\n});\n  \nfunction updateMap(locationData) {\n  if (!locationData || !locationData.features || locationData.features.length === 0) {\n    console.error('Location data is missing or invalid.');\n    return;\n  }\n\n  const coordinates = locationData.features[0].center;\n\n      // Update the map's center to the coordinates from locationData\n      map.flyTo({ center: coordinates, zoom: 10 });\n}\n\n  function displayWeather(data) {\n    if (!data) {\n      handleApiError(\"Weather data is undefined.\");\n      return;\n    }\n\n    const { name, sys, main, weather } = data;\n\n    const weatherHtml = `\n        <div class=\"card bg_blue-dark-color p-3 primary-color\" style=\"width: 18rem;\">\n          <div class=\"card-body\">\n            <h5 class=\"card-title d-flex flex-row\">\n            <span>\n            </span>\n            <span class=\"ms-2\">Weather in ${name} in ${sys.country}</span>\n            </h5>\n            <p class=\"card-text\"><span class=\"fw-semibold\">Temperature:</span> ${main.temp}\u00B0C</p>\n            <p class=\"card-text\"><span class=\"fw-semibold\">Conditions:</span> ${weather[0].description}</p>\n          </div>\n        </div>\n        <div class=\"card bg_blue-dark-color p-3 primary-color mt-3\" style=\"width: 18rem;\">\n          <div class=\"card-body\">\n            <div class=\"map-container\">\n              <div id=\"map\"></div>\n            </div>\n          </div>\n        </div>\n      `;\n\n    weatherDisplay.innerHTML = weatherHtml;\n    errorDisplay.textContent = \"\";\n\n\n  }\n\n\n  function handleApiError(errorMessage) {\n    showError(errorMessage);\n    weatherDisplay.textContent = \"\";\n  }\n\n  errorPopup.addEventListener(\"click\", hideError);\n\n  document.addEventListener(\"click\", (event) => {\n    if (event.target === errorPopup) {\n      hideError();\n    }\n  });\n\n  function showError(message) {\n    errorMessage.textContent = message;\n    errorPopup.style.display = \"flex\";\n  }\n\n  function hideError() {\n    errorPopup.style.display = \"none\";\n  }\n\n  function appendInfoButton() {\n    const infoButton = document.createElement(\"button\");\n    infoButton.textContent = \"+\";\n    infoButton.id = \"info-button\";\n    infoButton.classList.add(\"btn\", \"btn-light\", \"mt-3\");\n\n    infoButton.addEventListener(\"click\", () => {\n      displayMoreInfo(weatherData);\n    });\n\n    weatherDisplay.appendChild(infoButton);\n  }\n\n  function displayMoreInfo(data) {\n    if (!data) {\n      errorDisplay.textContent = \"Weather data is undefined.\";\n      return;\n    }\n\n    const { main, wind, sys } = data;\n    const moreInfoHtml = `\n      <div class=\"card bg_blue-dark-color p-3 primary-color mt-3\" style=\"width: 18rem;\">\n        <div class=\"card-body\">\n          <p class=\"card-text\"><span class=\"fw-semibold\">Humidity:</span> ${\n            main.humidity\n          }%</p>\n          <p class=\"card-text\"><span class=\"fw-semibold\">Wind Speed:</span> ${\n            wind.speed\n          } m/s</p>\n          <p class=\"card-text\"><span class=\"fw-semibold\">Sunrise:</span> ${new Date(\n            sys.sunrise * 1000\n          ).toLocaleTimeString()}</p>\n          <p class=\"card-text\"><span class=\"fw-semibold\">Sunset:</span> ${new Date(\n            sys.sunset * 1000\n          ).toLocaleTimeString()}</p>\n        </div>\n      </div>\n      `;\n\n    const moreInfoContainer = document.createElement(\"div\");\n    moreInfoContainer.innerHTML = moreInfoHtml;\n    weatherDisplay.appendChild(moreInfoContainer);\n    document.getElementById(\"info-button\").style.display = \"none\";\n  }\n});\n"],
  "mappings": "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",
  "names": ["locationData", "coordinates", "errorMessage"]
}
